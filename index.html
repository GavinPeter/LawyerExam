<!DOCTYPE html>
<html>
    <head><title>司律一試線上測驗</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="utf-8">
        <meta property="og:title" content="司律一試線上測驗">
        <meta property="og:description" content="以司律一試考古題為基礎，提供線上題庫練習">
        <meta property="og:type" content="website">
        
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
        <style>
        input[type='radio'] { transform: scale(2); }
		input[type='checkbox'] { transform: scale(2); }
        </style>
    </head>
    <body>
		
    <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container-fluid">
        <div class="navbar-header">
		<a class="navbar-brand visible-xs" href="#">司律一試</a>
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
			  <li class="dropdown">
				<a class="dropdown-toggle" data-toggle="dropdown" href="#">110 <span class="caret"></span></a>
				<ul class="dropdown-menu">
					<li><a href="#">110綜合法學(一)(憲法、行政法、國際公法、國際私法)</a></li>
					<li><a href="#">110綜合法學(二)(民法、民事訴訟法)</a></li>
					<li><a href="#">110綜合法學(二)(公司法、保險法、票據法、證券交易法、強制執行法、法學英文)</a></li>
					<li><a href="#">110綜合法學(一)(刑法、刑事訴訟法、法律倫理)</a></li>
				</ul>
			  </li>
			  <li class="dropdown">
				<a class="dropdown-toggle" data-toggle="dropdown" href="#">109
				<span class="caret"></span></a>
				<ul class="dropdown-menu">
					<li><a href="#">109綜合法學(一)(憲法、行政法、國際公法、國際私法)</a></li>
					<li><a href="#">109綜合法學(二)(民法、民事訴訟法)</a></li>
					<li><a href="#">109綜合法學(二)(公司法、保險法、票據法、證券交易法、強制執行法、法學英文)</a></li>
					<li><a href="#">109綜合法學(一)(刑法、刑事訴訟法、法律倫理)</a></li-->
				</ul>
			  </li>
          </ul>
		  
        </div><!--/.nav-collapse -->
      </div>
    </nav>

      

		  <div class="container">
            <div class="row">
                <p class="hidden-sm hidden-xs">&nbsp;</p>
                <h1 id="qa-quiz" class="col-md-12"></h1>
                <div id="qa-answer" class="col-md-12" style="font-size: 20pt;"></div>
                <h1 id="qa-result" class="col-md-12" style="color: red;"></h1>
                <div id="detail" class="col-md-12">
                    <div class="col-md-8 col-sm-12 col-xs-12">
                        <div class="btn-group btn-group-justified">
                            <a class="btn btn-primary btn-lg qa-previous" href="#">
                                上一題
                            </a>
                            <a class="btn btn-primary btn-lg qa-jump" href="#">
                                跳題
                            </a>
                            <a class="btn btn-primary btn-lg qa-next" href="#">
                                下一題
                            </a>
                        </div>
                        <div class="col-md-12" id="qa-status"></div>
                    </div>
 
                </div>
            </div>
            <div style="text-align: center;">
                <a href="https://github.com/lagendre/government_procurement_act" target="_blank">網站原始碼</a> |
                資料來源：考選部考古題
            </div>
        </div>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script>
        var currentIndex = 0, qa = [], total = 0;
        $(function() {
		
		//selectquiz( $(this).text() );

		$("ul .dropdown-menu li:nth-child("+(Math.floor(Math.random() * $('.dropdown-menu li').length )+1)+")").addClass("active");
			
		selectquiz( $(".nav").find(".active").text() );
		
		$(".nav a").on("click", function(){
			
			$(".nav").find(".active").removeClass("active");
			$(this).parent().addClass("active");
			
			selectquiz( $(this).text() );
		});
	

          $('.qa-previous').click(function() {
            currentIndex -= 1;
            if(currentIndex < 0) {
              currentIndex = total - 1;
            }
            showQuiz();
            return false;
          });
          $('.qa-next').click(function() {
            currentIndex += 1;
            if(currentIndex >= total) {
              currentIndex = 0;
            }
            showQuiz();
            return false;
          });
          $('.qa-jump').click(function() {
            currentIndex = window.prompt('輸入 1-' + total + ' 數字');
            currentIndex = parseInt(currentIndex) - 1;
            showQuiz();
            return false;
          });
	
        })
		
		function selectquiz( txt ){
		
		if ( txt.length <10 ){
			//console.log("error: " +  txt );
			return;
		}
		
			txt = txt.substring(0,3)+ "/" + txt;
		
		
			qa = [];
			
			$.when(
			$.get( txt+'.txt', function(data) {
			
				let line = data.split('\n');
				let quiz, ch1, ch2, ch3, ch4;
				for ( let i=0;i<line.length;i++ ){
				
					if ( line[i].indexOf('禁止使用電子計算器')!=-1 ){
		
							i=i+1;
						
							do {
								if ( isNumeric(line[i].slice(0, 1)) ){
									if ( (//g).test(line[i+1]) ){ //choice1 
										
										quiz = line[i];
										
									}
									else{
										quiz="";
										for ( let j=0;;j++ ){										
											if ( (//g).test(line[i+j])){
											 i= i+j-1;
											 break;
											}
											
											quiz += line[i+j];
										}
									}


										if (( (//g).test(line[i+1]) )){ //choice4 in next line
											ch4 = line[i+1].slice( line[i+1].indexOf('')+1, line[i+1].length);
											ch3 = line[i+1].slice(line[i+1].indexOf('')+1 , line[i+1].indexOf('') );
											ch2 = line[i+1].slice(line[i+1].indexOf('')+1 , line[i+1].indexOf('') );
											ch1 = line[i+1].slice(line[i+1].indexOf('')+1 , line[i+1].indexOf('') );
											i=i+2;
										}
										else if (( (//g).test(line[i+1]) )) { //choice2 in next line
											ch2 = line[i+1].slice(line[i+1].indexOf('')+1 , line[i+1].length );
											ch1 = line[i+1].slice(line[i+1].indexOf('')+1 , line[i+1].indexOf('') );
											ch4 = line[i+2].slice( line[i+2].indexOf('')+1, line[i+2].length);
											ch3 = line[i+2].slice(line[i+2].indexOf('')+1 , line[i+2].indexOf('') );
											i=i+3;
										}
										else{
											ch1 = line[i+1].replace(//g, '');
											ch2 = line[i+2].replace(//g, '');
											ch3 = line[i+3].replace(//g, '');
											ch4 = line[i+4].replace(//g, '');
											i=i+5;
 										}
								}
								else{
									//console.log(line[i]);
									i++;
									continue;
								}
							
								qa.push({
								"quiz": quiz,
								"options": {
								"A": ch1,
								"B": ch2,
								"C": ch3,
								"D": ch4
								},
								"answer":null,
								"choice":1
								});						
								
								

							} while (i < line.length);

					}
				}//end of for loop	
		
			}, 'text'),
			$.get( txt+'ANS.txt', function(data) {
					
				let line = data.split('\n');
				
				let index =0, ansArray=[];
				
				for ( let i=0;i<line.length;i++ ){
				
					if ( /[A-E]/g.test(line[i]) ){
						
						if (line[i].replace(/\r/g, '').length!=1){
						
							ansArray=[];
							
							qa[index].choice= 2;
							
							for (var j=0; j<line[i].length; j++){

								ansArray.push( line[i][j] );
								
							}
							
							qa[index].answer = ansArray;
							
						}
						else{
						
							qa[index].answer= line[i];
						}
						
						index++;

						if ( index == qa.length)
							return;
					}
				}//end of for loop	
			}, 'text')
			).then(function() {
				
				total = qa.length;
				
				currentIndex = Math.floor(Math.random() * qa.length);
				
				showQuiz();
				
				
			});
			
		}
		
        function showQuiz() {
			
          if (currentIndex > qa.length)
			currentIndex=0;
			
		  $('#qa-result').html('');
          $('#qa-quiz').html(qa[currentIndex].quiz);
          var answers = '';
		  
		  if (qa[currentIndex].choice==1){
			for(k in qa[currentIndex].options) {
				answers += '<label class="radio-inline"><input name="answer" class="qa-options" type="radio" value="' + k + '" />' + ' &nbsp; ' + qa[currentIndex].options[k] + '</label><br />';
			}
		  }
		  else{
			for(k in qa[currentIndex].options) {
				answers += '<label class="radio-inline"><input name="answer" class="qa-multi-options" type="checkbox" value="' + k + '" />' + ' &nbsp; ' + qa[currentIndex].options[k] + '</label><br />';
			}
			
			answers += '<button onclick="multichoice()">送出</button>';
			
		  }
		  
		  
          $('#qa-answer').html(answers);
		  
          $('input.qa-options').change(function() {
		  
            var selected = $(this).val();
            if(selected == qa[currentIndex].answer) {
              $('#qa-result').html("你答對了！");
            } else {
              $('#qa-result').html("你答錯了！正確答案應該是 -> " + qa[currentIndex].options[qa[currentIndex].answer]  );
            }
          });
		  

		  
          $('div#qa-status').html('第 ' + (currentIndex + 1) + ' 題 / 共 ' + total + ' 題');
        }
		
		function multichoice() {
		
			var userAns = [];
			var checkboxes = document.getElementsByName('answer');
			
			for(let i = 0;i< checkboxes.length;  i++ )
			{
				if(checkboxes[i].checked){  
					userAns.push( checkboxes[i].value );
				}
			}
	
				if( JSON.stringify(userAns)!=JSON.stringify(qa[currentIndex].answer) ) {
					let theAns="";
					qa[currentIndex].answer.forEach(function(value){
						theAns +=  "<br>" + qa[currentIndex].options[value] ;
					});
					
					$('#qa-result').html("你答錯了！正確答案應該是 -> " + theAns );
				}
				else{
					$('#qa-result').html("你答對了！");
				}
			
			
          }
		  
		function isNumeric(str) {
			if (typeof str != "string") return false // we only process strings!  
				return !isNaN(str) && // use type coercion to parse the _entirety_ of the string (`parseFloat` alone does not do this)...
			!isNaN(parseFloat(str)) // ...and ensure strings of whitespace fail
		}
		
        </script>
    </body>
</html>
